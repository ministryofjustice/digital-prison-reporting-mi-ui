{% extends "../partials/layout.njk" %}
{% from "dpr/components/reports-list/view.njk" import dprReportsList %}
{% from "govuk/components/tabs/macro.njk" import govukTabs %}
{% from "govuk/components/details/macro.njk" import govukDetails %}
{% from "dpr/components/async-request-list/view.njk" import dprAsyncRequestList %}
{% from "dpr/components/recently-viewed-list/view.njk" import dprRecentlyViewedList %}
{% from "dpr/components/reports-list/view.njk" import dprReportsList %}
{% from "dpr/components/user-list-content/view.njk" import dprUserList %}

{% set pageTitle = applicationName + " - " + title %}
{% set mainClasses = "app-container govuk-body" %}

{% block main %}
<main class="dpr-home-wrapper app-container govuk-body">
  <div class="dpr-heading-wrapper">
    <div class="govuk-width-container">
      <h1 class="govuk-heading-l govuk-!-margin-bottom-1">{{ title }}</h1>
      <p class="govuk-body">Find and view reports</p>
      <a href='#reports-catalogue' class='govuk-body govuk-link govuk-link--no-visited-state'>Reports Catalogue</a>
    </div>
  </div>

  {% set requestedReportsHtml %}
    {{ dprAsyncRequestList({
      head: requestedReports.head,
      tableData: requestedReports.tableData,
      total: requestedReports.total,
      meta: requestedReports.meta,
      csrf: requestedReports.csrfToken
    })}}
  {% endset -%}

  {% set recentlyViewedHtml %}
    {{ dprRecentlyViewedList({
      head: viewedReports.head,
      tableData: viewedReports.tableData,
      total: viewedReports.total,
      meta: viewedReports.meta,
      csrf: viewedReports.csrfToken
    }) }}
  {% endset -%}

  {% set bookmarksHtml %}
  <div id="dpr-bookmarks-list">
    {{ dprUserList({
      head: bookmarks.head,
      tableData: bookmarks.tableData,
      total: bookmarks.total
    }) }}
  </div>
  {% endset -%}

  <div id="homepage-widget" class="dpr-reports-widget-wrapper">
    <div class="govuk-width-container">
      <h2 class="govuk-heading-m">My Reports<h2>
      {{ govukTabs({
        items: [
          {
            label: "Requested (" + requestedReports.total.amount + ")",
            id: "requested-reports-tab",
            panel: {
              html: requestedReportsHtml
            }
          },
          {
            label: "Viewed (" + viewedReports.total.amount + ")",
            id: "recently-viewed-tab",
            panel: {
              html: recentlyViewedHtml
            }
          },
          {
            label: "Bookmarks (" + bookmarks.total.amount + ")",
            id: "my-bookmarks-tab",
            panel: {
              html: bookmarksHtml
            }
          }
        ]
      }) }}
    </div>
  </div>
  

  <div id="reports-catalogue" class="dpr-reports-wrapper">
    <div class="govuk-width-container">
      <h2 class="govuk-heading-l govuk-!-margin-bottom-2">Report Catalogue</h2>

      {% set howToUseHtml %}
        <h3 class="govuk-heading-s govuk-!-margin-bottom-1">Filtering the cataloge</h3>
        <p class="govuk-body">Filter the report catalogue by typing in the filter input box below. The cataloge will show listings that match your filter by name, description, type and product</p>
        
        <h3 class="govuk-heading-s govuk-!-margin-bottom-1">Viewing a report</h3>
        <p class="govuk-body">Click on the name of the report to start a request to view a report</p>

        <h3 class="govuk-heading-s govuk-!-margin-bottom-1">Bookmarking a report</h3>
        <p class="govuk-body">If you regularly visit a report you can bookmark it for quick access. Clicking the bookmark icon next to the report will add it to your bookmarks. All your bookmarks will appear in the <a href="#homepage-widget" class="govuk-link govuk-link--no-visited-state">Bookmarks</a> section on the homepage</p>
      {% endset %}

      {{ govukDetails({
        summaryText: "How to use",
        html: howToUseHtml
      }) }}

      {{ dprReportsList(reports.head, reports.rows) }}
    </div>
  <div>
</main>
{% endblock %}
